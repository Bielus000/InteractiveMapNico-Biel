<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mapa - Noctara</title>
  <link rel="stylesheet" href="css/map.css">
</head>

<body>
  <div class="site-frame">
    <header class="site-header">
      <div class="container">
        <!-- Header empty on map page: logo moved to side panel -->
      </div>
    </header>

    <!-- Side panel: fixed, full-height, overlaying the map (placeholder for interactive controls) -->
    <div class="side-panel" id="sidePanel" aria-hidden="false">
      <a class="logo-link panel-logo" href="index.html" aria-label="Inicio">
        <img src="img/logo2.png" alt="Noctara" class="logo-img">
      </a>

      <!-- panel content will be added here -->

      <!-- Legend button (bottom of panel) -->
      <button class="panel-btn btn-legend" id="btnLegend" aria-label="Abrir leyenda" title="Leyenda" aria-pressed="false" aria-expanded="true">
        <img src="img/icon-leyenda.png" alt="Leyenda" class="panel-icon">
      </button>
    </div> 

    <!-- Right side info panel (hidden by default) -->
    <aside class="info-panel" id="infoPanel" role="complementary" aria-hidden="true">
      <button class="info-panel-close" id="infoPanelClose" aria-label="Cerrar panel">×</button>
      <div class="info-panel-content" id="infoPanelContent">
        <!-- Content will be dynamically injected here -->
      </div>
    </aside>

    <main>
      <section class="map-frame" role="region" aria-label="Mapa interactivo">
        <div class="map-canvas" id="mapCanvas" tabindex="0" aria-live="polite">
          <img id="mapImage" src="img/map2.jpeg" alt="Mapa interactivo" draggable="false" />

          <!-- Map markers (example positions) -->
          <button class="map-marker" data-type="capital" data-name="Capital del Reino" style="left: 45%; top: 35%;">
            <img src="img/icon-capital.png" alt="Capital" class="marker-icon">
          </button>
          <button class="map-marker" data-type="ciudad" data-name="Fortaleza del Norte" style="left: 55%; top: 25%;">
            <img src="img/icon-ciudad.png" alt="Fortaleza" class="marker-icon">
          </button>
          <button class="map-marker" data-type="pueblo" data-name="Pueblo de los Ríos" style="left: 40%; top: 50%;">
            <img src="img/icon-pueblo.png" alt="Pueblo" class="marker-icon">
          </button>
          <button class="map-marker" data-type="interes" data-name="Ruinas Antiguas" style="left: 60%; top: 45%;">
            <img src="img/icon-interes.png" alt="Punto de interés" class="marker-icon">
          </button>
          <button class="map-marker" data-type="batalla" data-name="Frente de Batalla Sur" style="left: 50%; top: 65%;">
            <img src="img/icon-batalla.png" alt="Frente de batalla" class="marker-icon">
          </button>
          <button class="map-marker" data-type="info" data-name="Centro de Información" style="left: 35%; top: 40%;">
            <img src="img/icon-info.png" alt="Información" class="marker-icon">
          </button>

          <!-- Floating legend panel: positioned above the map, to the right of the side-panel -->
          <aside class="floating-legend" id="floatingLegend" role="complementary" aria-label="Leyenda del mapa" aria-hidden="false">
            <h3 class="legend-title">LEYENDA</h3>
            <ul class="legend-list">
              <li class="legend-item"><img src="img/icon-capital.png" alt="" class="legend-icon" aria-hidden="true"><span class="legend-text">CAPITALES</span></li>
              <li class="legend-item"><img src="img/icon-ciudad.png" alt="" class="legend-icon" aria-hidden="true"><span class="legend-text">FORTALEZAS</span></li>
              <li class="legend-item"><img src="img/icon-pueblo.png" alt="" class="legend-icon" aria-hidden="true"><span class="legend-text">POBLADOS</span></li>
              <li class="legend-item"><img src="img/icon-interes.png" alt="" class="legend-icon" aria-hidden="true"><span class="legend-text">PUNTOS DE INTERÉS</span></li>
              <li class="legend-item"><img src="img/icon-batalla.png" alt="" class="legend-icon" aria-hidden="true"><span class="legend-text">FRENTES DE BATALLA</span></li>
            </ul>
          </aside>

        </div>
      </section>
    </main>
  </div>

  <script src="js/map.js" defer></script>
  <script src="js/markers.js" defer></script>

  <!-- Inline fallback toggle: robust body-class toggle for legend -> works even if main script errors -->
  <script>
    (function(){
      const btn = document.getElementById('btnLegend');
      const floating = document.getElementById('floatingLegend');
      if(!btn || !floating){ console.warn('[fallback] legend elements missing'); return; }

      // Ensure initial state: open
      document.body.classList.remove('legend-hidden');
      floating.setAttribute('aria-hidden', 'false');
      btn.setAttribute('aria-pressed', 'false');
      btn.setAttribute('aria-expanded', 'true');

      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const hidden = document.body.classList.toggle('legend-hidden');
        floating.setAttribute('aria-hidden', hidden ? 'true' : 'false');
        btn.setAttribute('aria-pressed', hidden ? 'true' : 'false');
        btn.setAttribute('aria-expanded', hidden ? 'false' : 'true');
        console.info('[fallback] toggle clicked, hidden=', hidden);
      });

      // support keyboard activation
      btn.addEventListener('keydown', (e) => {
        if(e.key === ' ' || e.key === 'Spacebar' || e.key === 'Enter'){
          e.preventDefault();
          btn.click();
        }
      });
    })();
  </script>
</body>
</html>